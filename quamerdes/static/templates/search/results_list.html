<ul>
<% _.each(hits, function(hit){ console.log(hit);%>
    <li>
        <h2>
            <%
                var hit_id = hit._id,
                    source = hit._source.source;
                if(hit._type == 'expression'){
                    hit_id = hit_id.replace(/_/g, '/');
                    source = source.replace(/_/g, '/');
                }
            %>
            <a href="<%= source %>" target="_blank" data-id="<%= hit_id %>">
                <%
                var title = '<em>No title available</em>';
                if(hit.highlight.title){
                    title = hit.highlight.title;
                }
                else if(hit._source.title){
                    title = hit._source.title;
                }
                print(title);
                %>
            </a>
        </h2>
    <% if('highlight' in hit){ %>
        <ul class="description">
        <% _.each(hit.highlight, function(snippet, field){
                var source = '';
                if(field == 'subtitles'){
                    source = 'icon-comment';
                }
                else if(field == 'tweetText'){
                    source = 'icon-twitter';
                }
                else if(field == 'summaries'){
                    source = 'icon-film';
                }
                else if(field == 'descriptions'){
                    source = 'icon-film';
                }
            %>
            <li>
                <i class="<%= source %>"></i>
                <p class="snippet"><%= snippet[0] %></p>
            </li>
        <% }); %>
        </ul>
    <% } %>
        <ul class="metadata">
            <li>
                <i class="icon-calendar"></i>
                <%
                    // KB articles do not have a time associated, so use other date
                    // formatter. Include time by default
                    if(hit._type == 'article'){
                        var format = d3.time.format('%a %b %-e, %Y');
                    } else {
                        var format = d3.time.format('%a %b %-e, %Y at %H:%M');
                    }
                    var date_hit = format(new Date(hit._source.date));
                %>
                <%= date_hit %>
            </li>
        </ul>
    </li>
<% }); %>
</ul>
